<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="keywords" content="c++, python, java, html5, css3, 编程, 学生编程，个人博客，大学生博客"><meta name="description" content="目前是大二学生，没有可以拿出来说道的东西，慢慢学，慢慢走"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><title>埃氏筛法的更优化——欧拉筛法的详解 | 落阳的博客</title><link rel="shortcut icon" href="/favicon.ico"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css"><script src="/js/pace.min.js"></script><meta name="generator" content="Hexo 4.2.0"></head></html><body><div id="app"><main class="content"><section class="outer"><article id="post-埃氏筛法的更优化——欧拉筛法的详解" class="article article-type-post" itemscope itemprop="blogPost" data-scroll-reveal><div class="article-inner"><header class="article-header"><h1 class="article-title sea-center" style="border-left:0" itemprop="name">埃氏筛法的更优化——欧拉筛法的详解</h1></header><div class="article-meta"><a href="/2019/10/24/%E5%9F%83%E6%B0%8F%E7%AD%9B%E6%B3%95%E7%9A%84%E6%9B%B4%E4%BC%98%E5%8C%96%E2%80%94%E2%80%94%E6%AC%A7%E6%8B%89%E7%AD%9B%E6%B3%95%E7%9A%84%E8%AF%A6%E8%A7%A3/" class="article-date"><time datetime="2019-10-24T14:58:32.000Z" itemprop="datePublished">2019-10-24</time></a></div><div class="tocbot"></div><div class="article-entry" itemprop="articleBody"><h1 id="这个线性复杂度的欧拉素数筛法，爱了爱了"><a href="#这个线性复杂度的欧拉素数筛法，爱了爱了" class="headerlink" title="这个线性复杂度的欧拉素数筛法，爱了爱了"></a>这个线性复杂度的欧拉素数筛法，爱了爱了</h1><h6 id="今天讲一下关于欧拉筛法的原理和代码实现，实不相瞒，我也才刚get到这个筛法的点，乘着记忆清晰来教一遍梳理一下思路。"><a href="#今天讲一下关于欧拉筛法的原理和代码实现，实不相瞒，我也才刚get到这个筛法的点，乘着记忆清晰来教一遍梳理一下思路。" class="headerlink" title="今天讲一下关于欧拉筛法的原理和代码实现，实不相瞒，我也才刚get到这个筛法的点，乘着记忆清晰来教一遍梳理一下思路。"></a>今天讲一下关于欧拉筛法的原理和代码实现，实不相瞒，我也才刚get到这个筛法的点，乘着记忆清晰来教一遍梳理一下思路。</h6><p>我查阅资料的时候也在很多博客和公众号上看到关于欧拉筛法的解释和代码实现，然后想学习了之后用我自己的话重新描述一遍，希望我的角度能让你有所收获！</p><p>欧拉筛法与埃氏筛法一样，都是围绕【<strong>素数的倍数不是素数</strong>】这个核心原理来展开的，有关埃氏筛法请移步我的上一篇博客“<a href="http://hsluoyang.club/2019/10/22/%E5%9F%83%E6%B0%8F%E7%AD%9B%E6%B3%95%E7%9A%84%E7%90%86%E8%A7%A3%E4%B8%8E%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0/">埃氏筛法的详解</a>”，但是它比埃氏筛法更高效，当数据量足够大的时候，<strong>欧拉筛法的时间是埃氏筛法时间的十分之一甚至更少</strong>。</p><p>现在我们正式展开欧拉筛法的学习。</p><a id="more"></a><p>欧拉筛法效率高的一个重要原因是，<strong>它不会重复标记一个数是不是素数的倍数</strong>，例如：6是素数2的倍数，同时也是素数3的倍数，欧拉算法能做到只标记一次6。</p><p>我们先看一下代码</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n, cnt = <span class="number">0</span>; <span class="comment">// n是你要找的素数范围，cnt代表在这个范围内素数的个数</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> prime[<span class="number">100001</span>];<span class="comment">// 用来保存素数，注意，是用数组的值而不是用下标保存哦！</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">bool</span> visited[<span class="number">100001</span>];<span class="comment">// 就是这个数组！用来记录一个数是否是某个素数的倍数，标记它</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;n); <span class="comment">// 输入你想查找的范围</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">memset</span>(visited, <span class="literal">false</span>, <span class="keyword">sizeof</span>(visited));<span class="comment">// 初始化 </span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">memset</span>(prime, <span class="number">0</span>, <span class="keyword">sizeof</span>(prime));<span class="comment">// 初始化</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">2</span>; i &lt;= n; i++)</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!visited[i])<span class="comment">// 如果没有被标记过</span></span><br><span class="line"></span><br><span class="line">        &#123;</span><br><span class="line">            prime[cnt++] = i;<span class="comment">// 那么它就是素数啦~，存起来存起来，cnt记得+1 </span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j&lt;cnt &amp;&amp; i*prime[j]&lt;=n; j++) <span class="comment">// 这个循环是最难理解的部分，我将在下文详细解释</span></span><br><span class="line"></span><br><span class="line">        &#123;</span><br><span class="line"></span><br><span class="line">            visited[i*prime[j]] = <span class="literal">true</span>;<span class="comment">// 标记素数倍数</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(i % prime[j] == <span class="number">0</span>) <span class="keyword">break</span>;<span class="comment">// 这一步跳出循环是欧拉筛法高效率的关键，也是同一个合数只被标记一次的关键</span></span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ok，代码如上，可以直接拷贝过去试试哦！</p></blockquote><p>现在来详细分解一下那个for循环代码</p><h4 id="此处我们暂时抛开-if-i-prime-j-0-break-这句代码来讨论"><a href="#此处我们暂时抛开-if-i-prime-j-0-break-这句代码来讨论" class="headerlink" title="此处我们暂时抛开 if(i % prime[j] == 0) break; 这句代码来讨论"></a>此处我们暂时抛开 if(i % prime[j] == 0) break; 这句代码来讨论</h4><hr><p>for循环的循环变量 j 每次都从 0 开始跑，而这个 j 是从 prime[] 数组中取数据的，我们就可以这样等价，for循环每次都从已经找到的素数中从头开始取值。<br>例如 prime[] 中已经判断出了 2,3,5,7 那么for循环第一次取值2，如果没有跳出的话，第二次取值3，然后没有跳出的话就一直循环到已经找出的素数末尾。</p><p>然后</p><blockquote><p>visited[i*prime[j]] = true;</p></blockquote><p>这个代码段，是用来标记素数倍数的，例如，当 i 等于2的时候，素数数组里只存在一个素数 <strong>2</strong> ，然后进入 <strong>for</strong> 循环，<strong>for</strong> 循环会将 <strong>2</strong> 取出来与 <strong>i</strong> 相乘，得到 <strong>2</strong> 的倍数 <strong>4</strong> ，标记它，然后结束 <strong>for</strong> 循环。跑过 <strong>i = 3</strong>，执行到 <strong>i = 4</strong> 的时候，千万不要以为这个时候 <strong>for</strong> 循环不执行了！ 这个时候 <strong>for</strong> 循环依旧会尽职地把 <strong>2</strong> 取出来和 <strong>4</strong> 相乘，将 <strong>2</strong> 的倍数 <strong>8</strong> 标记！然后 不会取到第二个素数 <strong>3</strong> ，因为 <strong>4 % 2 == 0</strong> ——-</p><p>纵观之，如果我们不把</p><blockquote><p>if(i % prime[j] == 0) break;</p></blockquote><p>这段代码放在内的话， for 循环的作用就是将素数的倍数都标记上。</p><hr><h3 id="讨论关键性代码段-if-i-prime-j-0-break"><a href="#讨论关键性代码段-if-i-prime-j-0-break" class="headerlink" title="讨论关键性代码段 if(i % prime[j] == 0) break;"></a>讨论关键性代码段 if(i % prime[j] == 0) break;</h3><p>然后我们开始讨论上面那一小段代码的关键性作用：</p><p>18 是素数 3 的倍数，但是我们并不会用 3 的倍数来标记掉 18 , 因为假如我们用 3 来标记 18 ，那么 i 势必要跑到 6 这样 i * 3 才会标记掉18， 但是在这之前 i 就已经被 3 之前的一个素数 2 弄死了，退出循环了。<br>那么为什么要这么做？因为 6 既然能被 2 整除， 那么 18 迟早会被 2 标记，所以这里就不要再用 3 来重复标记 18。<br>你问我怎么知道 18 迟早会被 2 标记的？ 6 能被 2 整除，那么 3 乘 6 就可以分解为 3 乘 2 乘 3， 也就是 2 乘 9 ， 2 乘 9 就标记掉了18.</p><hr><h3 id="如果你看懂了上面的代码，我们再来总结一下"><a href="#如果你看懂了上面的代码，我们再来总结一下" class="headerlink" title="如果你看懂了上面的代码，我们再来总结一下"></a>如果你看懂了上面的代码，我们再来总结一下</h3><p>有个规律，不知道大家发现没有，<strong>凡是 i 跑到偶数位的时候，它永远只能与素数 2 相乘一次来标记掉一个数，然后因为能整除 2 而退出循环。</strong> 从这个规律，这个筛法的时间复杂度就可见一斑了。<br><strong>外层 i 循环用来选出素数和作为标记素数倍数的倍数因子，内层 j 循环用来从素数中最小的开始遍历作为标记素数倍数的素数因子。然后通过 i % 素数 == 0 来退出标记避免重复标记。</strong></p><p>谢谢你的观看！</p><p>你也可以转到我的csdn博客上去观看<a href="https://blog.csdn.net/luoyangIT/article/details/102731581" target="_blank" rel="noopener">http://hsluoyang.club/</a></p><div id="reward-btn">打赏</div></div><footer class="article-footer"><a data-url="http://hsluoyang.club/2019/10/24/%E5%9F%83%E6%B0%8F%E7%AD%9B%E6%B3%95%E7%9A%84%E6%9B%B4%E4%BC%98%E5%8C%96%E2%80%94%E2%80%94%E6%AC%A7%E6%8B%89%E7%AD%9B%E6%B3%95%E7%9A%84%E8%AF%A6%E8%A7%A3/" data-id="ck4j58rtq0001ssvo6abk9oli" class="article-share-link">分享</a></footer></div><nav class="article-nav"><a href="/2019/10/28/python%E6%A0%87%E5%87%86%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E5%A4%8D%E4%B9%A0/" class="article-nav-link"><strong class="article-nav-caption">上一篇</strong><div class="article-nav-title">python标准数据类型复习</div></a><a href="/2019/10/22/%E5%9F%83%E6%B0%8F%E7%AD%9B%E6%B3%95%E7%9A%84%E7%90%86%E8%A7%A3%E4%B8%8E%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0/" class="article-nav-link"><strong class="article-nav-caption">下一篇</strong><div class="article-nav-title">埃氏筛法的理解与代码实现</div></a></nav><div id="vcomments-box"><div id="vcomments"></div></div><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="https://cdn.jsdelivr.net/npm/valine@1.3.10/dist/Valine.min.js"></script><script>new Valine({
        el: '#vcomments',
        notify: false,
        verify: false,
        app_id: '5WSaK6bUDnRLhgbQjaL5R9Tq-gzGzoHsz',
        app_key: '7x0vYeAw0aRYU5SjaFugWDxh',
        path: window.location.pathname,
        avatar: 'mp',
        placeholder: '给我的文章加点评论吧~',
        recordIP: true
    });
    const infoEle = document.querySelector('#vcomments .info');
    if (infoEle && infoEle.childNodes && infoEle.childNodes.length > 0) {
        infoEle.childNodes.forEach(function (item) {
            item.parentNode.removeChild(item);
        });
    }</script><style>#vcomments-box{padding:5px 30px}@media screen and (max-width:800px){#vcomments-box{padding:5px 0}}#vcomments-box #vcomments{background-color:#fff}.v .vlist .vcard .vh{padding-right:20px}.v .vlist .vcard{padding-left:10px}</style></article></section><footer class="footer"><div class="outer"><ul class="list-inline"><li>&copy; 2019 落阳</li><li><a href="https://hexo.io" target="_blank">Hexo</a> Theme <a href="https://github.com/Shen-Yu/hexo-theme-ayer" target="_blank">Ayer</a> by shenyu</li></ul><ul class="list-inline"><li><ul class="list-inline"><li>PV:<span id="busuanzi_value_page_pv"></span></li><li>UV:<span id="busuanzi_value_site_uv"></span></li></ul></li><li></li></ul></div></footer><div class="to_top"><div class="totop" id="totop"><i class="ri-arrow-up-line"></i></div></div></main><aside class="sidebar"><button class="navbar-toggle"></button><nav class="navbar"><div class="logo"><a href="/"><img src="/images/touxiang.png" alt="落阳的博客"></a></div><ul class="nav nav-main"><li class="nav-item"><a class="nav-item-link" href="/">主页</a></li><li class="nav-item"><a class="nav-item-link" href="/archives">目录</a></li></ul></nav><nav class="navbar navbar-bottom"><ul class="nav"><li class="nav-item"><a class="nav-item-link nav-item-search" title="搜索"><i class="ri-search-line"></i> </a><a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed"><i class="ri-rss-line"></i></a></li></ul></nav><div class="search-form-wrap"><div class="local-search local-search-plugin"><input type="search" id="local-search-input" class="local-search-input" placeholder="Search..."><div id="local-search-result" class="local-search-result"></div></div></div></aside><div id="mask"></div><div id="reward"><span class="close"><i class="ri-close-line"></i></span><p class="reward-p"><i class="ri-cup-line"></i>谢谢你请我吃糖果~</p><div class="reward-box"><div class="reward-item"><img class="reward-img" src="/images/alipay.png"> <span class="reward-type">支付宝</span></div><div class="reward-item"><img class="reward-img" src="/images/weixin.png"> <span class="reward-type">微信</span></div></div></div><script src="/js/jquery-2.0.3.min.js"></script><script src="/js/jquery.justifiedGallery.min.js"></script><script src="/js/lazyload.min.js"></script><script src="/js/busuanzi-2.3.pure.min.js"></script><script src="/fancybox/jquery.fancybox.min.js"></script><script src="/js/tocbot.min.js"></script><script>tocbot.init({tocSelector:".tocbot",contentSelector:".article-entry",headingSelector:"h1, h2, h3, h4, h5, h6",hasInnerContainers:!0,scrollSmooth:!0,positionFixedSelector:".tocbot",positionFixedClass:"is-position-fixed",fixedSidebarOffset:"auto"})</script><script>var ayerConfig={mathjax:!1}</script><script src="/js/ayer.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.css"><script type="text/javascript" src="https://js.users.51.la/20544303.js"></script></div></body>